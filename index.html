<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visualizaciones Interactivas D3.js</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f0f0f0 0%, #e8e8e8 100%);
      min-height: 100vh;
      margin: 0;
    }
    .container {
      max-width: 1100px;
      margin: 40px auto;
      padding: 20px;
    }
    .visualization-section {
      margin-bottom: 48px;
      padding: 28px 20px;
      border-radius: 14px;
      background: #ffffff;
      box-shadow: 0 4px 20px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .visualization-section > h2 {
      text-align: center;
      color: #2d2d2d;
      font-size: 1.5em;
      margin-bottom: 18px;
      font-weight: 600;
    }
    .visualization-section > p {
      text-align: center;
      color: #2d2d2d;
      font-size: 1em;
      margin-bottom: 18px;
      font-weight: 600;
    }
    .visualization-section svg {
      display: block;
      margin: 0 auto;
      background: #f5f7fa;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .tooltip {
      position: absolute;
      background: rgba(50, 50, 50, 0.9);
      color: #fff;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 13px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1000;
    }
    .Ana-title {
      text-align: center;
      font-size: 2.2em;
      font-weight: 800;
      margin-top: 32px;
      margin-bottom: 38px;
      color: #2b2b2b;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="Ana-title">D3.js Visualization</h1>
    <p class="Ana-title">Ana Paula Ram√≠rez Romero</p>

    <div id="coords" class="visualization-section">
      <h2>Pixel Coordinates</h2>
      <svg width="300" height="300"></svg>
    </div>

    <div id="brushContainer" class="visualization-section">
      <h2>Brush Visualization</h2>
      <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        <svg id="brush1" width="300" height="300"></svg>
        <svg id="brush2" width="300" height="300"></svg>
      </div>
    </div>

    <div id="dragdropContainer" class="visualization-section">
      <h2>Drag and Drop</h2>
      <svg id="dragdrop" width="600" height="200">
        <circle cx="100" cy="100" r="20" fill="#4a90e2"></circle>
        <circle cx="300" cy="100" r="20" fill="#50e3c2"></circle>
        <circle cx="500" cy="100" r="20" fill="#9013fe"></circle>
      </svg>
    </div>

    <div id="staggerContainer" class="visualization-section">
      <h2>Stagger Animation</h2>
      <svg id="stagger" width="600" height="300"></svg>
    </div>

    <div id="lissajousContainer" class="visualization-section">
      <h2>Lissajous Curve</h2>
      <svg id="lissajous" width="300" height="300"></svg>
    </div>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <script>
    const tooltip = d3.select('#tooltip');

    function coordsPixels(selector) {
      var txt = d3.select(selector).append('text')
        .attr('font-size', 18)
        .attr('font-family', 'monospace')
        .attr('fill', '#333');
      var svg = d3.select(selector).attr('cursor', 'crosshair')
        .on('mousemove', function(event) {
          var pt = d3.pointer(event, svg.node());
          txt.attr('x', 18+pt[0]).attr('y', 6+pt[1])
            .text(Math.round(pt[0]) + ',' + Math.round(pt[1]));
        });
    }

    function makeBrush() {
      d3.csv("dense.csv").then(data => {
        const svg1 = d3.select("#brush1"),
              svg2 = d3.select("#brush2");

        const scBlue1 = d3.scaleLinear()
          .domain([0, 30, 60])
          .range(["#cce4f6", "#5a9bd4", "#1d4e89"]);

        const scBlue2 = d3.scaleLinear()
          .domain([0, 30, 60])
          .range(["#d9ecf2", "#72a8c1", "#244f75"]);

        const cs1 = drawCircles(svg1, data, d => +d["A"], d => +d["B"], scBlue1);
        const cs2 = drawCircles(svg2, data, d => +d["A"], d => +d["B"], scBlue2);

        svg1.call(installBrushHandler, data, cs1, cs2, scBlue1, scBlue2);
        svg2.call(installBrushHandler, data, cs1, cs2, scBlue1, scBlue2);
      });
    }

    function drawCircles(svg, data, accX, accY, sc) {
      return svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("r", 6)
        .attr("cx", accX)
        .attr("cy", accY)
        .attr("fill", sc(Infinity))
        .attr("fill-opacity", 0.7)
        .attr("stroke", "#fff")
        .attr("stroke-width", 1);
    }

    function installBrushHandler(svg, data, cs1, cs2, sc1, sc2) {
      svg.attr("cursor", "crosshair")
        .on("mousemove", function(event) {
          const pt = d3.pointer(event, svg.node());

          cs1.attr("fill", function(d, i) {
            const r = Math.hypot(pt[0] - +d3.select(this).attr("cx"), pt[1] - +d3.select(this).attr("cy"));
            data[i]["r"] = r;
            return sc1(r);
          });

          cs2.attr("fill", function(d, i) {
            return sc2(data[i]["r"]);
          });
        })
        .on("mouseleave", function() {
          cs1.attr("fill", sc1(Infinity));
          cs2.attr("fill", sc2(Infinity));
        });
    }

    function makeDragDrop() {
      const svg = d3.select("#dragdrop");
      svg.selectAll("circle")
        .call(d3.drag()
          .on("start", function() {
            d3.select(this).raise().attr("stroke", "#222").attr("stroke-width", 2);
          })
          .on("drag", function(event) {
            d3.select(this)
              .attr("cx", event.x)
              .attr("cy", event.y);
          })
          .on("end", function() {
            d3.select(this).attr("stroke", null).attr("stroke-width", null);
          })
        );
    }

    function makeStagger() {
      let ds1 = [2,1,3,5,7,8,9,9,9,8,7,5,3,1,2];
      let ds2 = [8,9,8,7,5,3,2,1,2,3,5,7,8,9,8];
      const n = ds1.length;
      const svg = d3.select("#stagger");
      const scX = d3.scaleLinear().domain([0,n]).range([50,540]);
      const scY = d3.scaleLinear().domain([0, d3.max([...ds1, ...ds2])]).range([250,50]);

      svg.selectAll("line")
        .data(ds1).enter().append("line")
        .attr("stroke", "#4a90e2").attr("stroke-width", 20).attr("stroke-linecap", "round")
        .attr("x1", (d,i)=>scX(i)).attr("y1", scY(0))
        .attr("x2", (d,i)=>scX(i)).attr("y2", d=>scY(d));

      svg.on("click", () => {
        [ds1, ds2] = [ds2, ds1];
        svg.selectAll("line").data(ds1)
          .transition().duration(1000).delay((d,i)=>200*i)
          .attr("y2", d=>scY(d))
          .attr("stroke", d => d > 5 ? "#50e3c2" : "#9013fe");
      });
    }

    function makeLissajous() {
      const svg = d3.select("#lissajous");
      const a = 1.9, b = 3.2, omega = 2*Math.PI/10000;
      let phi, prvX = 250, prvY = 150;

      const timer = d3.timer(t => {
        phi = omega * t;
        const x = 150 + 100 * Math.cos(a * phi);
        const y = 150 + 100 * Math.sin(b * phi);

        svg.selectAll("line")
          .each(function() { this.bogus_opacity *= .99 })
          .attr("stroke-opacity", function() { return this.bogus_opacity })
          .filter(function() { return this.bogus_opacity < 0.05 })
          .remove();

        svg.append("line")
          .each(function() { this.bogus_opacity = 1.0 })
          .attr("x1", prvX).attr("y1", prvY)
          .attr("x2", x).attr("y2", y)
          .attr("stroke", d3.interpolateRainbow(phi / (2 * Math.PI)))
          .attr("stroke-width", 2);

        prvX = x;
        prvY = y;

        if (t > 120e3) timer.stop();
      });
    }

    function initVisualizations() {
      coordsPixels('#coords svg');
      makeBrush();
      makeDragDrop();
      makeStagger();
      makeLissajous();
    }

    document.addEventListener('DOMContentLoaded', initVisualizations);
  </script>
</body>
</html>
